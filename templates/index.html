{% extends 'base.html' %}
{% block content %}
<h3 class="mb-3">Dashboard</h3>
<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="fw-semibold">Total Quantity (kg)</div>
      <div class="fs-4">{{ '%.2f'|format(total_qty) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="fw-semibold">Total CP</div>
      <div class="fs-4">&#8377; {{ '%.2f'|format(total_cp) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="fw-semibold">Total SP</div>
      <div class="fs-4">&#8377; {{ '%.2f'|format(total_sp) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
  <div class="card"><div class="card-body">
    <div class="fw-semibold">Total Freight</div>
    <div class="fs-4">&#8377; {{ '%.2f'|format(total_freight) }}</div>
  </div></div>
</div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="fw-semibold">Total P/L</div>
      <div class="fs-4 {% if total_pl >= 0 %}text-success{% else %}text-danger{% endif %}">&#8377; {{ '%.2f'|format(total_pl) }}</div>
    </div></div>
  </div>
</div>


<h5 class="mt-3">Current Month ({{ current_data.ym }})</h5>
<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="fw-semibold">Total Quantity (kg)</div>
      <div class="fs-4">{{ '%.2f'|format(current_data.qty) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="fw-semibold">Total CP</div>
      <div class="fs-4">&#8377; {{ '%.2f'|format(current_data.cp) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="fw-semibold">Total SP</div>
      <div class="fs-4">&#8377; {{ '%.2f'|format(current_data.sp) }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
  <div class="card"><div class="card-body">
    <div class="fw-semibold">Total Freight</div>
    <div class="fs-4">&#8377; {{ '%.2f'|format(current_data.freight) }}</div>
  </div></div>
</div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="fw-semibold">Total P/L</div>
      <div class="fs-4 {% if current_data.pl >= 0 %}text-success{% else %}text-danger{% endif %}">&#8377; {{ '%.2f'|format(current_data.pl) }}</div>
    </div></div>
  </div>
</div>

<h5>Latest Sales</h5>
<div class="table-responsive">
<table class="table table-sm table-striped align-middle">
  <thead>
    <tr>
      <th>Date</th>
      <th>Client</th>
      <!-- <th class="text-end">Qty (kg)</th>
      
      <th class="text-end">SP Total</th>
      <th class="text-end">CP</th> -->
      <th class="text-end">Freight</th>
      <th class="text-end">P/L</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  {% for s in latest %}
    <tr>
      <td>{{ s.date }}</td>
      <td>{{ s.client_name }}</td>
      <!-- <td class="text-end">{{ '%.2f'|format(s.total_qty) }}</td>
      
      <td class="text-end">&#8377; {{ '%.2f'|format(s.total_sp()) }}</td>
      <td class="text-end">&#8377; {{ '%.2f'|format(s.total_cp()) }}</td> -->
      <td class="text-end">{{ '%.2f'|format(s.freight or 0) }}</td>
      <td class="text-end {% if s.pl() >= 0 %}text-success{% else %}text-danger{% endif %}">&#8377; {{ '%.2f'|format(s.pl()) }}</td>
      <td class="text-nowrap">
        <a class="btn btn-sm btn-outline-primary" href="{{ url_for('sales_form', sale_id=s.id) }}">Edit</a>
        <!-- <form class="d-inline" method="post" action="{{ url_for('sales_delete', sale_id=s.id) }}" onsubmit="return confirm('Delete this sale?');">
          <button class="btn btn-sm btn-outline-danger">Delete</button>
        </form> -->
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
</div>

<h5 class="mt-4">Monthly (last 6)</h5>
<div class="table-responsive">
<table class="table table-sm">
  <thead>
    <tr>
      <th>Month</th>
      <th class="text-end">Qty (kg)</th>
      <th class="text-end">Freight</th>
      <th class="text-end">SP Total</th>
      <th class="text-end">CP Total</th>
      <th class="text-end">P/L</th>
    </tr>
  </thead>
  <tbody>
    {% for m in monthly %}
    <tr>
      <td>{{ m.ym }}</td>
      <td class="text-end">{{ '%.2f'|format(m.qty_kg or 0) }}</td>
      <td class="text-end">{{ m.freight | round(2) }}</td>
      <td class="text-end">&#8377; {{ '%.2f'|format(m.sp or 0) }}</td>
      <td class="text-end">&#8377; {{ '%.2f'|format(m.cp or 0) }}</td>
      <td class="text-end {% if m.pl >= 0 %}text-success{% else %}text-danger{% endif %}">&#8377; {{ '%.2f'|format(m.pl) }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}
