{% extends "base.html" %}
{% block content %}

<h3 class="mb-4">ðŸ“Š Business Dashboard</h3>

<!-- ===================== -->
<!-- TOP SUMMARY CARDS -->
<!-- ===================== -->
<div class="row g-3 mb-4">

  <div class="col-md-3">
    <div class="card shadow-sm p-3">
      <h6>Total Sales</h6>
      <h4>â‚¹ {{ total_sp }}</h4>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card shadow-sm p-3">
      <h6>Total Cost</h6>
      <h4>â‚¹ {{ total_cp }}</h4>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card shadow-sm p-3">
      <h6>Total Expense</h6>
      <h4 class="text-danger">â‚¹ {{ total_expense }}</h4>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card shadow-sm p-3 bg-success text-white">
      <h6>Net Profit</h6>
      <h4>â‚¹ {{ total_profit }}</h4>
    </div>
  </div>

</div>


<!-- ===================== -->
<!-- PENDING SUMMARY -->
<!-- ===================== -->
<div class="row g-3 mb-4">

  <div class="col-md-6">
    <div class="card p-3 shadow-sm">
      <h6>Receivable (Clients)</h6>
      <h4 class="text-warning">
        â‚¹ {{ total_sale_pending }}
      </h4>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card p-3 shadow-sm">
      <h6>Payable (Vendors)</h6>
      <h4 class="text-danger">
        â‚¹ {{ total_purchase_pending }}
      </h4>
    </div>
  </div>

</div>


<!-- ===================== -->
<!-- CURRENT MONTH -->
<!-- ===================== -->
<div class="card shadow-sm mb-4">
<div class="card-header fw-bold">
ðŸ“… Current Month ({{ current_data.ym }})
</div>

<div class="card-body">
<div class="row text-center">

  <div class="col-md-2">
    <small>Qty</small>
    <h5>{{ current_data.qty }} kg</h5>
  </div>

  <div class="col-md-2">
    <small>Sales</small>
    <h5>â‚¹ {{ current_data.sp }}</h5>
  </div>

  <div class="col-md-2">
    <small>Cost</small>
    <h5>â‚¹ {{ current_data.cp }}</h5>
  </div>

  <div class="col-md-2">
    <small>Freight</small>
    <h5>â‚¹ {{ current_data.freight }}</h5>
  </div>

  <div class="col-md-2">
    <small>Expense</small>
    <h5 class="text-danger">
      â‚¹ {{ current_data.expense }}
    </h5>
  </div>

  <div class="col-md-2">
    <small>Net P/L</small>
    <h5 class="{% if current_data.pl >=0 %}text-success{% else %}text-danger{% endif %}">
      â‚¹ {{ current_data.pl }}
    </h5>
  </div>

</div>
</div>
</div>


<!-- ===================== -->
<!-- MONTHLY PERFORMANCE -->
<!-- ===================== -->
<div class="card shadow-sm mb-4">

<div class="card-header fw-bold">
ðŸ“ˆ Monthly Performance
</div>

<div class="table-responsive">
<table class="table table-striped mb-0">

<thead class="table-dark">
<tr>
<th>Month</th>
<th>Qty (kg)</th>
<th>Sales</th>
<th>Cost</th>
<th>Freight</th>
<th>Expense</th>
<th>Net Profit</th>
</tr>
</thead>

<tbody>
{% for m in monthly %}
<tr>
<td>{{ m.ym }}</td>
<td>{{ m.qty_kg }}</td>
<td>â‚¹ {{ m.sp }}</td>
<td>â‚¹ {{ m.cp }}</td>
<td>â‚¹ {{ m.freight }}</td>
<td class="text-danger">â‚¹ {{ m.expense }}</td>

<td class="{% if m.pl >=0 %}text-success{% else %}text-danger{% endif %}">
â‚¹ {{ m.pl }}
</td>
</tr>
{% endfor %}
</tbody>

</table>
</div>
</div>


<!-- ===================== -->
<!-- LATEST SALES -->
<!-- ===================== -->
<div class="card shadow-sm">

<div class="card-header fw-bold">
ðŸ§¾ Latest Sales
</div>

<div class="table-responsive">
<table class="table table-sm table-hover mb-0">

<thead class="table-light">
<tr>
<th>Date</th>
<th>Client</th>
<th>Qty</th>
<th>Total</th>
<th>Status</th>
</tr>
</thead>

<tbody>
{% for s in latest %}
<tr>
<td>{{ s.date }}</td>
<td>{{ s.client_name }}</td>
<td>{{ s.total_qty }}</td>
<td>â‚¹ {{ s.total_amount() }}</td>

<td>
<span class="badge
{% if s.payment_status()=='Paid' %}
bg-success
{% elif s.payment_status()=='Partial' %}
bg-warning
{% else %}
bg-danger
{% endif %}
">
{{ s.payment_status() }}
</span>
</td>

</tr>
{% endfor %}
</tbody>

</table>
</div>

</div>

{% endblock %}